/*
 * This is an example of using JavaScript with NodeJS to collect ticks for your trading app using Deriv's API.
 * To run this example using NodeJS
 * - Ensure you have NodeJs installed (https://nodejs.org/).
 * - Save this script to a directory on your computer as `ticks.js`.
 * - Run `npm install ws` to install the websocket library.
 * - Run `npm install @deriv/deriv-api` to install the Deriv API library.
 * - Edit the example and change the app_id (Replace with your app_id or leave as 1089 for testing).
 * - Then run `node ticks.js`.
 */

const WebSocket = require('ws');
const DerivAPIBasic = require('@deriv/deriv-api/dist/DerivAPIBasic');
const app_id = 1089; // Replace with your app_id or leave as 1089 for testing.
const connection = new WebSocket(`wss://ws.binaryws.com/websockets/v3?app_id=${app_id}`);
const api = new DerivAPIBasic({ connection });

const tickResponse = (res) => {
    const data = JSON.parse(res.data);
    console.log(data.tick);
    // After 15 seconds, will stop tick response.
    setTimeout(async () => {
        connection.removeEventListener('message', tickResponse, false);
        await api.disconnect();
    }, 15000)
}

const ticks = async () => {
    await api.ticks('R_100');
    connection.addEventListener('message', tickResponse);
}

ticks();
